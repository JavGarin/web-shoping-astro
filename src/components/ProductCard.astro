---
import type { Product } from '../types';

export interface Props {
  product: Product;
}

const { product } = Astro.props;
---

<div class="group block overflow-hidden rounded-lg border border-earth-brown shadow-sm transition-all duration-300 hover:shadow-xl hover:scale-105">
  <a href={`/products/${product.id}`}>
    <img
      src={product.imageUrl}
      alt={`Image of ${product.name}`}
      class="h-[350px] w-full object-cover"
    />
  </a>

  <div class="relative bg-cream-beige p-4">
    <a href={`/products/${product.id}`}>
      <h3 class="text-base text-charcoal-gray group-hover:underline group-hover:underline-offset-4">
        {product.name}
      </h3>
    </a>

    <p class="mt-2">
      <span class="tracking-wider text-charcoal-gray font-medium">${product.price}</span>
    </p>

    <button
      class="add-to-cart-btn mt-4 w-full rounded-md bg-forest-green px-4 py-2 text-sm font-medium text-cream-beige shadow hover:bg-earth-brown transition-colors"
      data-product={JSON.stringify(product)}
    >
      AÃ±adir al Carrito
    </button>
  </div>
</div>

<script>
  import { addToCart } from '../lib/cart';

  function setupButtons() {
    document.querySelectorAll('.add-to-cart-btn').forEach(button => {
      const btn = button as HTMLElement;
      if (btn.dataset.listenerAttached) return;

      btn.addEventListener('click', () => {
        const productData = btn.getAttribute('data-product');
        if (productData) {
          const product = JSON.parse(productData);
          addToCart(product);
        }
      });
      btn.dataset.listenerAttached = 'true';
    });
  }

  document.addEventListener('astro:page-load', setupButtons);
  setupButtons();
</script>
