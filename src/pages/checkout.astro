---
export const prerender = false;
import Layout from '../layouts/Layout.astro';

const { user } = Astro.locals;

if (!user) {
  return Astro.redirect('/login');
}
---

<Layout title="Checkout | TheCountryHouse">
  <div class="mx-auto max-w-screen-xl px-4 py-12 sm:px-6 lg:px-8">
    <h1 class="text-3xl font-bold text-center text-charcoal-gray">Checkout</h1>

    <div class="mt-12 grid grid-cols-1 gap-8 md:grid-cols-2">
      <div class="rounded-lg bg-cream-beige p-6 shadow-md">
        <h2 class="text-2xl font-semibold text-charcoal-gray">Resumen del pedido</h2>
        <div id="order-summary" class="mt-6 space-y-4"></div>
        <div class="mt-6 border-t border-earth-brown pt-4">
          <p class="text-right text-xl font-bold">Total: <span id="order-total">$0.00</span></p>
        </div>
      </div>

      <div class="rounded-lg bg-cream-beige p-6 shadow-md">
        <h2 class="text-2xl font-semibold text-charcoal-gray">Opciones de pago</h2>
        <div class="mt-6 space-y-4">
          <p class="text-charcoal-gray">Selecciona un método de pago. Serás redirigido a una pasarela de pago externa para completar tu compra.</p>
          
          <a href="#" class="flex w-full items-center justify-center rounded-md bg-blue-600 px-6 py-3 text-lg font-medium text-white shadow-md transition-transform hover:scale-105">
            Pagar con PayPal
          </a>
          
          <a href="#" class="flex w-full items-center justify-center rounded-md bg-purple-600 px-6 py-3 text-lg font-medium text-white shadow-md transition-transform hover:scale-105">
            Pagar con Stripe
          </a>
        </div>
      </div>
    </div>
  </div>
</Layout>

<script>
  import { getCart } from '../lib/cart';

  function renderOrderSummary() {
    const orderSummaryContainer = document.getElementById('order-summary');
    const orderTotal = document.getElementById('order-total');

    if (!orderSummaryContainer || !orderTotal) return;

    const cart = getCart();
    orderSummaryContainer.innerHTML = '';

    if (cart.length === 0) {
      orderSummaryContainer.innerHTML = '<p class="text-charcoal-gray">Tu carrito esta vacío.</p>';
    } else {
      cart.forEach(item => {
        const orderItem = document.createElement('div');
        orderItem.className = 'flex items-center justify-between';
        orderItem.innerHTML = `
          <div>
            <h3 class="text-md font-medium text-charcoal-gray">${item.product.name}</h3>
            <p class="text-sm text-charcoal-gray">Cantidad: ${item.quantity}</p>
          </div>
          <p class="text-md font-medium">$${(item.product.price * item.quantity).toFixed(2)}</p>
        `;
        orderSummaryContainer.appendChild(orderItem);
      });
    }

    const total = cart.reduce((sum, item) => sum + item.product.price * item.quantity, 0);
    orderTotal.textContent = `$${total.toFixed(2)}`;
  }

  document.addEventListener('astro:page-load', renderOrderSummary);
  renderOrderSummary();
</script>
